// ==UserScript==
// @name         ToodleChute
// @namespace    https://github.com/nettabo/toodlechute
// @description  Toodledoでタスクシュートしたくなるツール
// @author       nettabo
// @version      0.1.3
// @include      http://www.toodledo.com/tasks/index.php*
// @include      https://www.toodledo.com/tasks/index.php*      
// ==/UserScript==
(function(e,c){var b=e.getElementsByTagName("head")[0];var a=e.createElement("script");a.setAttribute("src","http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js");a.addEventListener("load",function(){var d=e.createElement("script");d.textContent="jQuery.noConflict();("+c.toString()+")(jQuery);";b.appendChild(d)},false);b.appendChild(a)})(document,function(d){var b=function(){var f=d("#head").width();var g=d('<style type="text/css">#tc-wrapper {position: relative; top: 0px; left: 0px; width: '+f+"px; height: 35px; margin-top: 1px; margin-bottom: 1px;} #tc-hoge {display: -webkit-box; display: -moz-box; position: relative; top: 0px; left: 0px; width: 100%; height: 21px; background-color: #D8D8D1; margin-top: 1px; margin-bottom: 1px; border-bottom: 1px solid #999; text-align: center; font-size: 12px;} #tc-sec-a {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 1; -moz-box-ordinal-group: 1; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-b {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 2; -moz-box-ordinal-group: 2; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-c {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 3; -moz-box-ordinal-group: 3; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-d {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 4; -moz-box-ordinal-group: 4; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-e {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 5; -moz-box-ordinal-group: 5; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-f {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 6; -moz-box-ordinal-group: 6; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-g {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 7; -moz-box-ordinal-group: 7; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-h {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 8; -moz-box-ordinal-group: 8; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-i {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 9; -moz-box-ordinal-group: 9; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-j {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 10; -moz-box-ordinal-group: 10; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-k {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 11; -moz-box-ordinal-group: 11; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-l {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 12; -moz-box-ordinal-group: 12; padding-top: 5px;} #tc-buri {position: relative; top: 0px; left: 0px; width: 100%; height: 12px; background-color: #eeeeee; margin-bottom: 1px;} #tc-bar-a {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-b {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-c {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-d {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-e {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-f {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-g {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-h {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-i {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-j {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-k {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-l {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-now {position: absolute; z-index: 1; top: 0px; left: 0px; width: 0px; height: 12px; font-size: 10px; background-color: #eeeeee; color: #000000; text-align: right;} #tc-bar-end {position: absolute; z-index: 1; top: 0px; left: 0px; width: 0px; height: 12px; font-size: 10px; background-color: #eeeeee; color: #000000; text-align: left;} </style>");g.appendTo("body")};var a=function(){var f=d('<div id="tc-wrapper"></div>').hide();var g=d('<div id="tc-hoge"></div>');f.append(g);g.append('<div id="tc-sec-a">A=0:00</div>');g.append('<div id="tc-sec-b">B=0:00</div>');g.append('<div id="tc-sec-c">C=0:00</div>');g.append('<div id="tc-sec-d">D=0:00</div>');g.append('<div id="tc-sec-e">E=0:00</div>');g.append('<div id="tc-sec-f">F=0:00</div>');g.append('<div id="tc-sec-g">G=0:00</div>');g.append('<div id="tc-sec-h">H=0:00</div>');g.append('<div id="tc-sec-i">I=0:00</div>');g.append('<div id="tc-sec-j">J=0:00</div>');g.append('<div id="tc-sec-k">K=0:00</div>');g.append('<div id="tc-sec-l">L=0:00</div>');var h=d('<div id="tc-buri"></div>');g.after(h);h.append('<div id="tc-bar-now"></div>');h.append('<div id="tc-bar-a"></div>');h.append('<div id="tc-bar-b"></div>');h.append('<div id="tc-bar-c"></div>');h.append('<div id="tc-bar-d"></div>');h.append('<div id="tc-bar-e"></div>');h.append('<div id="tc-bar-f"></div>');h.append('<div id="tc-bar-g"></div>');h.append('<div id="tc-bar-h"></div>');h.append('<div id="tc-bar-i"></div>');h.append('<div id="tc-bar-j"></div>');h.append('<div id="tc-bar-k"></div>');h.append('<div id="tc-bar-l"></div>');h.append('<div id="tc-bar-end"></div>');d("#colhead").before(f);return f};function c(){var p={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0};d(".row").each(function(){var y=d(this).find("span[id^=con]").text().toUpperCase();if(y.match(/^([A-L])/)){var B=RegExp.$1;d("#tc-sec-h").css("border-right","none");d("#tc-sec-i").hide();d("#tc-sec-j").hide();d("#tc-sec-k").hide();d("#tc-sec-l").hide();var A=d(this).find("span[class=len]").text().split(" ");if(A.length>1){var z=A[0];var C=A[1];if(C.match(/^hour/)){z=z*60}if(!d(this).hasClass("rowcomp")){p[B]=parseInt(p[B],10)+parseInt(z,10)}}}});var h=new Date();var v=h.getMonth()+1;var x=h.getDate();var k=("0"+h.getHours()).slice(-2);var w=("0"+h.getMinutes()).slice(-2);var s=("0"+h.getSeconds()).slice(-2);var n=d("#tc-wrapper").width();var g=false;var o=6;var t=0;if(parseInt(k,10)<parseInt(o,10)){t=(n*(((24+parseInt(k,10)-o)*60)+parseInt(w,10)))/(24*60);h.setDate(x-1);v=h.getMonth()+1;x=h.getDate();g=true}else{t=(n*(((k-o)*60)+parseInt(w,10)))/(24*60)}Math.round(t);var r=d(".tabon").text();var q=r.match(/[0-9]+/g);var f=false;if(d("#tabs").text().match(/(Today|今日)/i)){if(!g&&r.match(/(Today|今日)/i)){f=true}else{if(g&&r.match(/(Yesterday|昨日)/i)){f=true}}}else{if(q){if(q.length==2){if((parseInt(q[0],10)==parseInt(v,10))&&(parseInt(q[1],10)==parseInt(x,10))){f=true}}else{if(parseInt(q[0],10)==parseInt(x,10)){f=true}}}}if(f){d("#tc-bar-now").text(k+":"+w).width(t).css("border-right","1px solid #000")}else{d("#tc-bar-now").text("").width(0).css("border-right","none")}var m=d("#tc-bar-now").width()+1;var u=0;d.each(p,function(B,D){var z=parseInt(D/60,10);var A=("0"+(D-(z*60))).slice(-2);d("#tc-sec-"+B.toLowerCase()).text(B+"="+z+":"+A);if(D>0){var C=Math.round((n*D)/(24*60));var E;var y=3*60;if(D>y){E="#ee99bc"}else{if(D>(y*0.9)){E="#ffd900"}else{E="#a7be53"}}d("#tc-bar-"+B.toLowerCase()).css("left",m).width(C).css("background-color",E);m+=C+1;u+=D}else{d("#tc-bar-"+B.toLowerCase()).width(0)}});var j;if(f){j=h}else{j=new Date();j.setHours(o);j.setMinutes(0)}j.setMinutes(j.getMinutes()+u);var i=("0"+j.getHours()).slice(-2);var l=("0"+j.getMinutes()).slice(-2);d("#tc-bar-end").css("left",m).text(i+":"+l);if(d("#vb8").hasClass("selected")){e.show()}else{if(d("#vb4").hasClass("selected")&&d(".tabon").text().match(/(Today|Tomorrow)/)){e.show()}else{e.hide()}}window.setTimeout(function(){c()},1000)}b();var e=a();c()});