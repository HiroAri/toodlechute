// ==UserScript==
// @name         ToodleChute
// @namespace    https://github.com/nettabo/toodlechute
// @description  Toodledoでタスクシュートしたくなるツール
// @author       nettabo
// @version      0.1.0
// @include      http://www.toodledo.com/tasks/index.php*
// @include      https://www.toodledo.com/tasks/index.php*      
// ==/UserScript==
(function(e,c){var b=e.getElementsByTagName("head")[0];var a=e.createElement("script");a.setAttribute("src","http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js");a.addEventListener("load",function(){var d=e.createElement("script");d.textContent="jQuery.noConflict();("+c.toString()+")(jQuery);";b.appendChild(d)},false);b.appendChild(a)})(document,function(d){var b=function(){var f=d("#head").width();var g=d('<style type="text/css">#tc-wrapper {position: relative; top: 0px; left: 0px; width: '+f+"px; height: 35px; margin-top: 1px; margin-bottom: 1px;} #tc-hoge {display: -webkit-box; display: -moz-box; position: relative; top: 0px; left: 0px; width: 100%; height: 21px; background-color: #D8D8D1; margin-top: 1px; margin-bottom: 1px; border-bottom: 1px solid #999; text-align: center; font-size: 12px;} #tc-sec-a {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 1; -moz-box-ordinal-group: 1; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-b {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 2; -moz-box-ordinal-group: 2; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-c {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 3; -moz-box-ordinal-group: 3; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-d {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 4; -moz-box-ordinal-group: 4; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-e {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 5; -moz-box-ordinal-group: 5; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-f {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 6; -moz-box-ordinal-group: 6; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-g {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 7; -moz-box-ordinal-group: 7; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-h {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 8; -moz-box-ordinal-group: 8; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-i {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 9; -moz-box-ordinal-group: 9; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-j {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 10; -moz-box-ordinal-group: 10; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-k {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 11; -moz-box-ordinal-group: 11; border-right: 1px solid #FFF; padding-top: 5px;} #tc-sec-l {-webkit-box-flex: 1; -moz-box-flex: 1; background: transparent; -webkit-box-ordinal-group: 12; -moz-box-ordinal-group: 12; padding-top: 5px;} #tc-buri {position: relative; top: 0px; left: 0px; width: 100%; height: 12px; background-color: #eeeeee; margin-bottom: 1px;} #tc-bar-a {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-b {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-c {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-d {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-e {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-f {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-g {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-h {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-i {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-j {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-k {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-l {position: absolute; z-index: 0; top: 0px; left: 0px; width: 0%; height: 12px; font-size: 10px;} #tc-bar-now {position: absolute; z-index: 1; top: 0px; left: 0px; width: 0px; height: 12px; font-size: 10px; background-color: #eeeeee; color: #000000; text-align: right;} #tc-bar-end {position: absolute; z-index: 1; top: 0px; left: 0px; width: 0px; height: 12px; font-size: 10px; background-color: #eeeeee; color: #000000; text-align: left;} </style>");g.appendTo("body")};var a=function(){var f=d('<div id="tc-wrapper"></div>').hide();var g=d('<div id="tc-hoge"></div>');f.append(g);g.append('<div id="tc-sec-a">A=0:00</div>');g.append('<div id="tc-sec-b">B=0:00</div>');g.append('<div id="tc-sec-c">C=0:00</div>');g.append('<div id="tc-sec-d">D=0:00</div>');g.append('<div id="tc-sec-e">E=0:00</div>');g.append('<div id="tc-sec-f">F=0:00</div>');g.append('<div id="tc-sec-g">G=0:00</div>');g.append('<div id="tc-sec-h">H=0:00</div>');g.append('<div id="tc-sec-i">I=0:00</div>');g.append('<div id="tc-sec-j">J=0:00</div>');g.append('<div id="tc-sec-k">K=0:00</div>');g.append('<div id="tc-sec-l">L=0:00</div>');var h=d('<div id="tc-buri"></div>');g.after(h);h.append('<div id="tc-bar-now"></div>');h.append('<div id="tc-bar-a"></div>');h.append('<div id="tc-bar-b"></div>');h.append('<div id="tc-bar-c"></div>');h.append('<div id="tc-bar-d"></div>');h.append('<div id="tc-bar-e"></div>');h.append('<div id="tc-bar-f"></div>');h.append('<div id="tc-bar-g"></div>');h.append('<div id="tc-bar-h"></div>');h.append('<div id="tc-bar-i"></div>');h.append('<div id="tc-bar-j"></div>');h.append('<div id="tc-bar-k"></div>');h.append('<div id="tc-bar-l"></div>');h.append('<div id="tc-bar-end"></div>');d("#colhead").before(f);return f};d("a").click(function(f){if(f.target.href.match(/#search/)){e.show()}else{e.hide()}});function c(){var u={A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0};d(".row").each(function(){var x=d(this).find("span[id^=con]").text().toUpperCase();if(x.match(/^([A-Z])[^A-Z]/)){var A=RegExp.$1;if(A=="A"){var w=x.split(/[^0-9]+/);var D;var C;if(w.length>4){D=w[1];C=w[3]}else{D=w[1];C=w[2]}localStorage.sectionStartTime=parseInt(D,10);localStorage.sectionLength=C-D;if(localStorage.sectionLength==3){d("#tc-sec-h").css("border-right","none");d("#tc-sec-i").hide();d("#tc-sec-j").hide();d("#tc-sec-k").hide();d("#tc-sec-l").hide()}else{d("#tc-sec-h").css("border-right","1px solid #FFF");d("#tc-sec-i").show();d("#tc-sec-j").show();d("#tc-sec-k").show();d("#tc-sec-l").show()}}var z=d(this).find("span[class=len]").text().split(" ");if(z.length>1){var y=z[0];var B=z[1];if(B.match(/^hour/)){y=y*60}if(!d(this).hasClass("rowcomp")){u[A]=parseInt(u[A],10)+parseInt(y,10)}}}});var g=new Date();var m=g.getMonth()+1;var s=g.getDate();var k=("0"+g.getHours()).slice(-2);var p=("0"+g.getMinutes()).slice(-2);var v=("0"+g.getSeconds()).slice(-2);var q=d("#tc-wrapper").width();var i=localStorage.sectionStartTime;var n=0;if(parseInt(k,10)<parseInt(i,10)){n=(q*(((24+parseInt(k,10)-i)*60)+parseInt(p,10)))/(24*60);g.setDate(s-1);m=g.getMonth()+1;s=g.getDate()}else{n=(q*(((k-i)*60)+parseInt(p,10)))/(24*60)}Math.round(n);var h=d(".tabon").text().match(/[0-9]+/g);var f=false;if(h){if(h.length==2){if((parseInt(h[0],10)==parseInt(m,10))&&(parseInt(h[1],10)==parseInt(s,10))){f=true}}else{if(parseInt(h[0],10)==parseInt(s,10)){f=true}}}if(f){d("#tc-bar-now").text(k+":"+p).width(n).css("border-right","1px solid #000")}else{d("#tc-bar-now").text("").width(0).css("border-right","none")}var t=d("#tc-bar-now").width()+1;var r=0;d.each(u,function(z,B){var x=parseInt(B/60,10);var y=("0"+(B-(x*60))).slice(-2);d("#tc-sec-"+z.toLowerCase()).text(z+"="+x+":"+y);if(B>0){var A=Math.round((q*B)/(24*60));var C;var w=localStorage.sectionLength*60;if(B>w){C="#ee99bc"}else{if(B>(w*0.9)){C="#ffd900"}else{C="#a7be53"}}d("#tc-bar-"+z.toLowerCase()).css("left",t).width(A).css("background-color",C);t+=A+1;r+=B}else{d("#tc-bar-"+z.toLowerCase()).width(0)}});var l;if(f){l=g}else{l=new Date();l.setHours(i);l.setMinutes(0)}l.setMinutes(l.getMinutes()+r);var j=("0"+l.getHours()).slice(-2);var o=("0"+l.getMinutes()).slice(-2);d("#tc-bar-end").css("left",t).text(j+":"+o);window.setTimeout(function(){c()},1000)}localStorage.sectionStartTime=localStorage.sectionStartTime?localStorage.sectionStartTime:6;localStorage.sectionLength=localStorage.sectionLength?localStorage.sectionLength:3;b();var e=a();if(d("#vb8").hasClass("selected")){e.show()}c()});
